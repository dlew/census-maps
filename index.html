<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0px; padding: 0px }
  #map_canvas { height: 100% }
</style>
<script type="text/javascript"
    src="http://maps.google.com/maps/api/js?sensor=false">
</script>
<script type="text/javascript" src="data.js"></script>
<script type="text/javascript">
// Controlling variables
// This determines the max opacity a gradient can have when comparing neighborhoods
// Theoretically when you do a comparison, the highest neighborhood
// should have this gradient
var MAX_OPACITY = .9;

// Data driving the script
var Data = {};

// References for each neighborhood
Data.NH = {
	BANCROFT: "Bancroft",
	BRYANT: "Bryant",
    CARAG: "CARAG",
    CEDAR_RIVERSIDE: "CedarRiverside",
    CENTRAL: "Central",
    COOPER: "Cooper",
    CORCORAN: "Corcoran",
    DOWNTOWN_WEST: "DowtownWest",
    ECCO: "ECCO",
    EAST_HARRIET: "EastHarriet",
    EAST_ISLES: "EastIsles",
    ELLIOT_PARK: "ElliotPark",
    ERICSSON: "Ericsson",
    FIELD: "Field",
    HIAWATHA: "Hiawatha",
    HOWE: "Howe",
    KEEWAYDIN: "Keewaydin",
    KING_FIELD: "KingField",
    LONGFELLOW: "Longfellow",
    LORING_PARK: "LoringPark",
    LOWRY_HILL: "LowryHill",
    LOWRY_HILL_EAST: "LowryHillEast",
    LYNDALE: "Lyndale",
    MINNEHAHA: "Minnehaha",
    MORRIS_PARK: "MorrisPark",
    NORTHROP: "northrop",
    NORTH_LOOP: "NorthLoop",
    PHILLIPS: "Phillips",
    POWDERHORN_PARK: "PowderhornPark",
    REGINA: "regina",
    SEWARD: "Seward",
    STANDISH: "Standish",
    STEVENS_SQ_LORING_HGTS: "StevensSquareLoringHeights",
    VENTURA_VILLAGE: "VenturaVillage",
    WENONAH: "Wenonah",
    WHITTIER: "Whittier",
}

// Initial point data - should only be used once each
// to initialize each region
Data.NH_POINTS = {};
Data.NH_POINTS[Data.NH.BANCROFT] = [
	44.926936, -93.26251,
	44.934137, -93.26251,
	44.934122, -93.24734,
	44.926906, -93.247318,
];
Data.NH_POINTS[Data.NH.BRYANT] = [
	44.926891, -93.274612,
	44.934091, -93.274655,
	44.934152, -93.262489,
	44.926921, -93.26251,
	44.926845, -93.27002,
	44.926754, -93.271351,
];
Data.NH_POINTS[Data.NH.CARAG] = [
    44.948357, -93.298275,
    44.948353, -93.288109,
    44.937676, -93.288227,
    44.937684, -93.298382
];
Data.NH_POINTS[Data.NH.CEDAR_RIVERSIDE] = [
	44.966164, -93.25206,
	44.970476, -93.252704,
	44.972206, -93.251352,
	44.975849, -93.246911,
	44.977565, -93.245537,
	44.977292, -93.242576,
	44.976897, -93.241932,
	44.976062, -93.241675,
	44.975106, -93.241954,
	44.973573, -93.241374,
	44.973588, -93.241739,
	44.9755, -93.243542,
	44.975485, -93.245687,
	44.974195, -93.245924,
	44.969975, -93.245666,
	44.96996, -93.24204,
	44.970218, -93.240881,
	44.969094, -93.238392,
	44.968001, -93.232813,
	44.96536, -93.23292,
	44.965284, -93.229852,
	44.964737, -93.228951,
	44.964358, -93.230453,
	44.964327, -93.242426,
	44.964798, -93.244829,
	44.966164, -93.248627,
];
Data.NH_POINTS[Data.NH.CENTRAL] = [
	44.948338, -93.274806,
	44.948338, -93.262682,
	44.934152, -93.262446,
	44.934122, -93.274655,
];
Data.NH_POINTS[Data.NH.COOPER] = [
	44.941428, -93.217835,
	44.953702, -93.217734,
	44.954116, -93.216441,
	44.954458, -93.215615,
	44.955331, -93.214016,
	44.954519, -93.213351,
	44.954033, -93.212814,
	44.952271, -93.210379,
	44.950973, -93.207997,
	44.950297, -93.206463,
	44.949621, -93.205626,
	44.948376, -93.205165,
	44.946941, -93.204188,
	44.945027, -93.203394,
	44.943341, -93.203051,
	44.941549, -93.203909,
];
Data.NH_POINTS[Data.NH.CORCORAN] = [
	44.937722, -93.247383,
	44.948368, -93.247404,
	44.948353, -93.238285,
	44.937646, -93.231118,
];
Data.NH_POINTS[Data.NH.DOWNTOWN_WEST] =  [
	44.969565, -93.269506,
	44.969929, -93.271244,
	44.972601, -93.27781,
	44.97292, -93.278861,
	44.975424, -93.280814,
	44.97714, -93.281608,
	44.978946, -93.281543,
	44.978931, -93.280706,
	44.980433, -93.278389,
	44.984501, -93.272467,
	44.982088, -93.268991,
	44.984713, -93.265214,
	44.984258, -93.264291,
	44.9823, -93.261824,
	44.982012, -93.261566,
	44.981299, -93.259914,
	44.980798, -93.259592,
	44.980069, -93.258455,
	44.975349, -93.262424,
	44.97591, -93.263819,
	44.971129, -93.267832,
	44.970324, -93.269033,
];
Data.NH_POINTS[Data.NH.ECCO] =  [
    44.948338, -93.298259,
    44.937676, -93.298345,
    44.937646, -93.304009,
    44.943114, -93.30358,
    44.948399, -93.306327
];
Data.NH_POINTS[Data.NH.EAST_HARRIET] = [
	44.919628, -93.297894,
	44.923913, -93.29622,
	44.925022, -93.296585,
	44.92648, -93.296134,
	44.926754, -93.295662,
	44.9268, -93.293431,
	44.929625, -93.293431,
	44.929694, -93.307464,
	44.93043, -93.307883,
	44.931084, -93.308033,
	44.931296, -93.308355,
	44.931433, -93.308837,
	44.932466, -93.308526,
	44.933256, -93.308065,
	44.933871, -93.307539,
	44.936264, -93.3046,
	44.937456, -93.303849,
	44.937646, -93.303806,
	44.937684, -93.288227,
	44.919583, -93.288324,
];
Data.NH_POINTS[Data.NH.EAST_ISLES] = [
    44.948353, -93.29828,
    44.948368, -93.304954,
    44.951026, -93.304996,
    44.952833, -93.302314,
    44.953623, -93.301992,
    44.954154, -93.30152,
    44.955126, -93.301156,
    44.955642, -93.30137,
    44.956022, -93.301971,
    44.956402, -93.30313,
    44.956766, -93.303452,
    44.957859, -93.303173,
    44.960198, -93.30122,
    44.96082, -93.30122,
    44.960896, -93.292787,
    44.955506, -93.2968,
    44.952241, -93.298302,
];
Data.NH_POINTS[Data.NH.ELLIOT_PARK] = [
	44.965891, -93.269784,
	44.97002, -93.269312,
	44.971113, -93.267982,
	44.975925, -93.263819,
	44.974514, -93.260386,
	44.973922, -93.26,
	44.973208, -93.260515,
	44.969975, -93.25309,
	44.967181, -93.25397,
	44.966286, -93.25515,
	44.965891, -93.258069,
];
Data.NH_POINTS[Data.NH.ERICSSON] = [
	44.916042, -93.247318,
	44.926921, -93.247318,
	44.926906, -93.246074,
	44.925113, -93.246009,
	44.925068, -93.232148,
	44.926891, -93.232126,
	44.926906, -93.223608,
	44.919613, -93.218629,
	44.91627, -93.215067,
	44.916225, -93.216816,
	44.916407, -93.217696,
	44.916377, -93.239551,
	44.916194, -93.240516,
];
Data.NH_POINTS[Data.NH.FIELD] = [
	44.910283, -93.274763,
	44.919628, -93.27472,
	44.919689, -93.262575,
	44.911393, -93.262639,
	44.911225, -93.263927,
	44.911393, -93.264592,
	44.912046, -93.265321,
	44.912684, -93.26618,
	44.912684, -93.269227,
	44.912593, -93.269656,
	44.912259, -93.270364,
	44.911666, -93.270578,
	44.911362, -93.270729,
	44.911119, -93.271115,
];
Data.NH_POINTS[Data.NH.HIAWATHA] = [
	44.916491, -93.215432,
	44.919674, -93.218694,
	44.93043, -93.226118,
	44.930681, -93.20715,
	44.930871, -93.206549,
	44.930833, -93.205165,
	44.930484, -93.204725,
	44.930742, -93.203834,
	44.930727, -93.203212,
	44.929428, -93.203266,
	44.927901, -93.202997,
	44.927058, -93.203233,
	44.924521, -93.204467,
	44.923366, -93.205347,
	44.922226, -93.204403,
	44.921619, -93.204317,
	44.920403, -93.204746,
];
Data.NH_POINTS[Data.NH.HOWE] = [
	44.930446, -93.226118,
	44.941291, -93.233521,
	44.941504, -93.204403,
	44.940759, -93.204403,
	44.939666, -93.204103,
	44.938831, -93.204467,
	44.938208, -93.205926,
	44.937661, -93.206055,
	44.9364, -93.204939,
	44.935595, -93.203781,
	44.93236, -93.20318,
	44.930765, -93.203223,
	44.930461, -93.204768,
	44.930825, -93.205218,
	44.930841, -93.206592,
	44.930658, -93.20715,
];
Data.NH_POINTS[Data.NH.KEEWAYDIN] = [
	44.905253, -93.237426,
	44.905542, -93.238478,
	44.908095, -93.235924,
	44.908915, -93.235602,
	44.912563, -93.233478,
	44.915982, -93.233478,
	44.916012, -93.222814,
	44.905374, -93.222921,
];
Data.NH_POINTS[Data.NH.KING_FIELD] = [
	44.919545, -93.288324,
	44.937691, -93.288217,
	44.937722, -93.274698,
	44.919644, -93.274698,
];
Data.NH_POINTS[Data.NH.LONGFELLOW] = [
	44.956508, -93.243649,
	44.955506, -93.241096,
	44.954595, -93.238757,
	44.953714, -93.234658,
	44.953198, -93.221891,
	44.95338, -93.219316,
	44.953699, -93.217771,
	44.941428, -93.217857,
	44.941261, -93.233585,
	44.950358, -93.239679,
	44.95338, -93.241975,
];
Data.NH_POINTS[Data.NH.LORING_PARK] = [
	44.964737, -93.286843,
	44.965694, -93.288045,
	44.970445, -93.28768,
	44.971918, -93.287444,
	44.97506, -93.28738,
	44.975349, -93.283346,
	44.975895, -93.281071,
	44.972905, -93.278861,
	44.972631, -93.277831,
	44.969869, -93.271008,
	44.96958, -93.269591,
	44.966012, -93.269827,
	44.966756, -93.274591,
	44.964616, -93.283925,
	44.964403, -93.285491,
];
Data.NH_POINTS[Data.NH.LOWRY_HILL] = [
	44.96082, -93.301392,
	44.963098, -93.303838,
	44.963265, -93.303773,
	44.963249, -93.303301,
	44.966407, -93.30328,
	44.966422, -93.304524,
	44.968108, -93.304567,
	44.968563, -93.304052,
	44.969094, -93.302486,
	44.969216, -93.299181,
	44.968897, -93.297873,
	44.969094, -93.296499,
	44.969869, -93.295469,
	44.969808, -93.29047,
	44.969064, -93.290191,
	44.968882, -93.288217,
	44.966392, -93.28856,
	44.960911, -93.292766,
]
Data.NH_POINTS[Data.NH.LOWRY_HILL_EAST] = [
    44.948368, -93.29828,
    44.952241, -93.298259,
    44.955521, -93.296757,
    44.962703, -93.291392,
    44.966483, -93.288195,
    44.948353, -93.288109,
];
Data.NH_POINTS[Data.NH.LYNDALE] = [
	44.948353, -93.288109,
	44.948338, -93.274806,
	44.937752, -93.274655,
	44.937676, -93.288217,
];
Data.NH_POINTS[Data.NH.MINNEHAHA] = [
	44.905344, -93.222921,
	44.915982, -93.222792,
	44.915997, -93.217728,
	44.916255, -93.216805,
	44.914234, -93.21629,
	44.914128, -93.215647,
	44.913945, -93.211634,
	44.909174, -93.205605,
	44.90697, -93.200541,
	44.905344, -93.199189,
];
Data.NH_POINTS[Data.NH.MORRIS_PARK] = [
	44.896149, -93.222921,
	44.905374, -93.222942,
	44.90539, -93.207622,
	44.896301, -93.207643,
	44.896088, -93.208137,
	44.896073, -93.210862,
	44.894264, -93.210926,
	44.894233, -93.217943,
	44.896103, -93.217921,
];
Data.NH_POINTS[Data.NH.NORTHROP] = [
	44.911377, -93.262661,
	44.926906, -93.262532,
	44.926906, -93.247318,
	44.916012, -93.247297,
	44.916058, -93.248563,
	44.915906, -93.249872,
	44.915541, -93.25103,
	44.913809, -93.253241,
	44.913505, -93.254421,
	44.913566, -93.256159,
	44.913094, -93.258219,
	44.912517, -93.26,
	44.911864, -93.260944,
];
Data.NH_POINTS[Data.NH.NORTH_LOOP] = [
	44.97506, -93.287444,
	44.981906, -93.287315,
	44.987506, -93.288646,
	44.988705, -93.288538,
	44.99045, -93.287272,
	44.991922, -93.285148,
	44.992059, -93.277059,
	44.992317, -93.275342,
	44.991452, -93.27457,
	44.990541, -93.274505,
	44.99001, -93.27384,
	44.990314, -93.271952,
	44.989494, -93.269806,
	44.988583, -93.269033,
	44.987992, -93.267596,
	44.985988, -93.266501,
	44.984729, -93.265171,
	44.982118, -93.268991,
	44.984486, -93.272467,
	44.981344, -93.276823,
	44.979007, -93.280835,
	44.978916, -93.281565,
	44.977003, -93.281522,
	44.976032, -93.281565,
	44.97544, -93.283195,
];
Data.NH_POINTS[Data.NH.PHILLIPS] = [
	44.948293, -93.274806,
	44.949796, -93.274591,
	44.951952, -93.273346,
	44.956143, -93.269935,
	44.957328, -93.269527,
	44.960911, -93.269484,
	44.960896, -93.262553,
	44.959104, -93.262553,
	44.959142, -93.249861,
	44.960942, -93.24985,
	44.960775, -93.247619,
	44.957358, -93.244185,
	44.955551, -93.24307,
	44.951907, -93.240838,
	44.948353, -93.23822,
];
Data.NH_POINTS[Data.NH.POWDERHORN_PARK] = [
	44.948353, -93.262639,
	44.948353, -93.247404,
	44.934091, -93.24734,
	44.934137, -93.262467,
];
Data.NH_POINTS[Data.NH.REGINA] = [
	44.919628, -93.274677,
	44.92686, -93.274698,
	44.926875, -93.273175,
	44.926708, -93.27148,
	44.926875, -93.26987,
	44.926921, -93.26251,
	44.919689, -93.262596,
];
Data.NH_POINTS[Data.NH.SEWARD] = [
	44.966255, -93.24985,
	44.965739, -93.247361,
	44.964676, -93.244421,
	44.964282, -93.241825,
	44.964327, -93.230817,
	44.964783, -93.228908,
	44.962551, -93.225582,
	44.957464, -93.218114,
	44.955566, -93.215303,
	44.955612, -93.213587,
	44.954671, -93.215218,
	44.95382, -93.217428,
	44.953349, -93.220153,
	44.953228, -93.222213,
	44.953562, -93.229187,
	44.953699, -93.234744,
	44.954503, -93.238735,
	44.955566, -93.241396,
	44.956751, -93.243735,
	44.959909, -93.246696,
	44.96082, -93.245795,
];
Data.NH_POINTS[Data.NH.STANDISH] = [
	44.925098, -93.246052,
	44.926906, -93.246052,
	44.926906, -93.247318,
	44.937691, -93.247383,
	44.937707, -93.231118,
	44.926921, -93.223672,
	44.926875, -93.232126,
	44.925068, -93.232126,
];
Data.NH_POINTS[Data.NH.STEVENS_SQ_LORING_HGTS] = [
	44.962688, -93.287991,
	44.965352, -93.288023,
	44.964699, -93.287187,
	44.964373, -93.286361,
	44.964267, -93.285577,
	44.964327, -93.284547,
	44.964358, -93.284343,
	44.96643, -93.276125,
	44.966559, -93.274409,
	44.966551, -93.273475,
	44.96583, -93.269988,
	44.962703, -93.269999,
];
Data.NH_POINTS[Data.NH.VENTURA_VILLAGE] = [
	44.96085, -93.26957,
	44.965785, -93.269763,
	44.965921, -93.255215,
	44.966255, -93.249979,
	44.960911, -93.245816,
	44.959696, -93.246911,
	44.960896, -93.248348,
	44.960911, -93.24985,
	44.95915, -93.249872,
	44.959104, -93.262575,
	44.960911, -93.262532,
];
Data.NH_POINTS[Data.NH.WENONAH] = [
	44.895632, -93.247168,
	44.899721, -93.247168,
	44.900906, -93.247511,
	44.900663, -93.246267,
	44.900724, -93.243756,
	44.901651, -93.242447,
	44.902396, -93.241096,
	44.905542, -93.238499,
	44.905298, -93.237877,
	44.905344, -93.222942,
	44.897532, -93.222985,
	44.897425, -93.232405,
	44.89741, -93.237212,
];
Data.NH_POINTS[Data.NH.WHITTIER] = [
	44.962688, -93.288002,
	44.962718, -93.27002,
	44.956872, -93.269999,
	44.956219, -93.270257,
	44.953471, -93.272402,
	44.951011, -93.274355,
	44.949416, -93.275042,
	44.948338, -93.27517,
	44.948338, -93.288109,
];


// Filled by initializeNeighborhoods()
Data.NH_Polys = {};

// Stored elements
var elInfoTable;

function initialize() {
    var latlng = new google.maps.LatLng(44.942263, -93.287144);
    var myOptions = {
        zoom: 13,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    Data.map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

    google.maps.event.addListener(Data.map, 'click', function() {
        // Deselect a neighborhood if user clicks somewhere off the map
        if (lastNeighborhood) {
            deselectNeighborhood(lastNeighborhood);
        }
    });

    initializeNeighborhoods();

    elInfoTable = document.getElementById("infotable");
}

var initializeNeighborhoods = function() {
    for (var nh in Data.NH_POINTS) {
        var points = Data.NH_POINTS[nh];
        var gLatLngs = [];
        for (var a = 0; a < points.length; a += 2) {
            gLatLngs[gLatLngs.length] = new google.maps.LatLng(points[a], points[a + 1]);
        }
        Data.NH_Polys[nh] = new google.maps.Polygon({
            paths: gLatLngs,
            strokeColor: "#FF0000",
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: "#FF0000",
            fillOpacity: 0.35,
            map: Data.map
        });

        var fun = (function() {
            var name = nh;
            return function() {
                selectNeighborhood(name);
            };
        })();

        google.maps.event.addListener(Data.NH_Polys[nh], 'click', fun);
    }
};

var lastNeighborhood;
var selectNeighborhood = function(name) {
    // Deselect the previous neighborhood
    if (lastNeighborhood) {
        if (lastNeighborhood === name) {
            return;
        }
        deselectNeighborhood(lastNeighborhood);
    }

    // Set the color of the selected neighborhood
    Data.NH_Polys[name].setOptions({
        strokeColor: "#0000FF",
        fillColor: "#0000FF",
    });

    // Setup the info box on the right
    var data = NH_DATA[name];

    // Temporarily remove box while manipulating DOM
    var tableParent = elInfoTable.parentNode;
    tableParent.removeChild(elInfoTable);

    var tableBody = document.createElement("tbody");

    // Add new data
    for (var index = 0; index < NH_SPEC.length; index++) {
        var field = NH_SPEC[index];

        var row = document.createElement("tr");

        var subjectCell = document.createElement("td");
        var subjectCellText = document.createTextNode(field["desc"]);
        subjectCell.appendChild(subjectCellText);

        var valueCell = document.createElement("td");
        var valueCellText = document.createTextNode(data[field["field"]]);
        valueCell.appendChild(valueCellText);

        row.appendChild(subjectCell);
        row.appendChild(valueCell);
        tableBody.appendChild(row);
    }

    elInfoTable.appendChild(tableBody);

    // Re-add the info table to the DOM
    tableParent.appendChild(elInfoTable);

    // Set the last neighborhood
    lastNeighborhood = name;
}

var deselectNeighborhood = function(name) {
    Data.NH_Polys[name].setOptions({
        strokeColor: "#FF0000",
        fillColor: "#FF0000",
    });

    while (elInfoTable.childNodes.length > 0) {
        elInfoTable.removeChild(elInfoTable.childNodes[0]);
    }
}

var compareNeighborhoods = function(el) {
    switch(el.selectedIndex) {
        case 0:
            // Reset all neighborhoods
            for (var poly in Data.NH_Polys) {
                Data.NH_Polys[poly].setOptions({
                    fillOpacity: 0.35
                });
            }
            break;
        case 1:
            // Compare population
            simpleComparison("pop_total");
            break;
        case 2:
            // Compare female population
            normalizedComparison("pop_female", "pop_total");
            break;
        case 3:
            // Compare children under 6
            normalizedComparison("pop_children", "pop_total");
            break;
        case 4:
            // Compare mean commute time
            simpleComparison("commute_mean");
            break;
        case 5:
            // Compare median household income
            simpleComparison("income_hh_median");
            break;
        case 6:
            // Compare median family income
            simpleComparison("income_family_median");
            break;
    }
}

var simpleComparison = function(fieldName) {
    var max = -1;
    for (var nameKey in Data.NH) {
    	var val = NH_DATA[Data.NH[nameKey]][fieldName];
        if (val > max) {
        	max = val;
        }
    }

    for (var nameKey in Data.NH) {
        var name = Data.NH[nameKey];
        Data.NH_Polys[name].setOptions({
            fillOpacity: ((NH_DATA[name][fieldName] / max) * MAX_OPACITY)
        });
    }
}

var normalizedComparison = function(fieldName, normalizerFieldName) {
	var max = -1;
    for (var nameKey in Data.NH) {
        var data = NH_DATA[Data.NH[nameKey]]
        var val = data[fieldName] / data[normalizerFieldName];
        if (val > max) {
        	max = val;
        }
    }

    for (var nameKey in Data.NH) {
        var name = Data.NH[nameKey];
        var data = NH_DATA[Data.NH[nameKey]]
        var percent = data[fieldName] / data[normalizerFieldName];
        Data.NH_Polys[name].setOptions({
            fillOpacity: ((percent / max) * MAX_OPACITY)
        });
    }
}
</script>
</head>
<body onload="initialize()">
  <table style="width: 100%; height: 100%">
    <tr style="height: 1px">
        <td colspan="2"><h1>Minneapolis Census Map</h1></td>
    </tr>
    <tr style="height: 1px">
    	<td colspan="2">Doesn't work in Firefox or Internet Explorer.  Get Chrome or Safari.  Problem?</td>
    </tr>
    <tr style="height: 1px">
        <td colspan="2">
        	Compare neighborhood data:
            <select onchange="compareNeighborhoods(this);">
                <option>TRY THIS IT IS AWESOME, TRUST ME</option>
                <option>Population</option>
                <option>% Female population</option>
                <option>% Children under 6</option>
                <option>Mean travel time</option>
                <option>Median household income</option>
                <option>Median family income</option>
            </select>
        </td>
    </tr>
    <tr>
        <td style="width:70%"><div id="map_canvas" style="width:100%; height:100%"></div></td>
        <td><table id="infotable"></table></td>
    </tr>
  </table>
</body>
</html>
